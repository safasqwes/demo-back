server:
  port: 8080
  servlet:
    context-path: /

spring:
  application:
    name: novelhub
  # Spring profiles
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}  # dev, test, prod
    # Spring Boot automatically loads application-{profile}.yml
    # e.g., application-dev.yml will be loaded when profile is 'dev'
  
  # 数据源配置
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/novelhub?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ${MYSQL_USERNAME:test1}
    password: ${MYSQL_PASSWORD:test1}
    druid:
      # 初始化连接池大小
      initial-size: 5
      # 最小空闲连接数
      min-idle: 10
      # 最大活跃连接数
      max-active: 20
      # 获取连接等待超时时间
      max-wait: 60000
      # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位毫秒
      time-between-eviction-runs-millis: 60000
      # 配置一个连接在池中最小生存时间
      min-evictable-idle-time-millis: 300000
      # 用来检测连接是否有效的sql
      validation-query: SELECT 1
      # 申请连接时执行validationQuery检测连接是否有效
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      # 打开PSCache，并且指定每个连接上PSCache的大小
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      # 配置监控统计拦截的filters
      filters: stat,wall
      # WebStatFilter配置
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"
      # StatViewServlet配置
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        reset-enable: false
        login-username: ${DRUID_LOGIN_USERNAME:admin}
        login-password: ${DRUID_LOGIN_PASSWORD:admin123}
  
  # Fastjson2 配置
  fastjson2:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    # 序列化配置
    writer-features:
      - WriteMapNullValue
      - PrettyFormat
      - WriteNullListAsEmpty
      - WriteNullStringAsEmpty
    # 反序列化配置
    reader-features:
      - FieldBased
      - SupportArrayToBean

  # 邮件服务配置
  mail:
    host: ${SMTP_HOST:smtp.gmail.com}
    port: ${SMTP_PORT:587}
    username: ${SMTP_USERNAME:}
    password: ${SMTP_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
          ssl:
            trust: ${SMTP_HOST:}

  # Redis Configuration
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

  # Spring Security
  security:
    user:
      name: ${SPRING_SECURITY_USERNAME:admin}
      password: ${SPRING_SECURITY_PASSWORD:admin123}

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:}
  expiration: 604800  # 7 days in seconds

# Google OAuth Configuration
google:
  client-id: ${GOOGLE_CLIENT_ID:}
  client-secret: ${GOOGLE_CLIENT_SECRET:}
  # 代理配置（可选）
  proxy:
    host: ${GOOGLE_PROXY_HOST:127.0.0.1}  # 代理服务器地址，如：127.0.0.1
    port: ${GOOGLE_PROXY_PORT:7897}  # 代理服务器端口，如：7890
    type: ${GOOGLE_PROXY_TYPE:HTTP}  # 代理类型：HTTP 或 SOCKS

coinbase:
  proxy:
    host: ${GOOGLE_PROXY_HOST:127.0.0.1}  # 代理服务器地址，如：127.0.0.1
    port: ${GOOGLE_PROXY_PORT:7897}  # 代理服务器端口，如：7890
    type: ${GOOGLE_PROXY_TYPE:HTTP}  # 代理类型：HTTP 或 SOCKS

# Stripe Configuration
stripe:
  api-key: ${STRIPE_API_KEY:sk_test_...}
  webhook-secret: ${STRIPE_WEBHOOK_SECRET:whsec_...}
  success-url: ${STRIPE_SUCCESS_URL:http://localhost:3000/payment/success}
  cancel-url: ${STRIPE_CANCEL_URL:http://localhost:3000/payment/cancel}

# Binance Pay Configuration
binance:
  pay:
    api-key: ${BINANCE_PAY_API_KEY:}
    api-secret: ${BINANCE_PAY_API_SECRET:}
    api-url: ${BINANCE_PAY_API_URL:https://bpay.binanceapi.com}

# Points System Configuration
points:
  daily-claim-amount: 100
  max-free-points: 1000
  verification-token-expiry: 86400  # 24 hours in seconds

# Fingerprint Validation Configuration
fingerprint:
  enabled: true
  timestamp:
    maxAge: 300  # 5 minutes in seconds

# Web3 Payment Configuration
web3:
  recipient:
    sepolia: ${WEB3_RECIPIENT_SEPOLIA:}
    polygon-amoy: ${WEB3_RECIPIENT_POLYGON_AMOY:}
    polygon: ${WEB3_RECIPIENT_POLYGON:}
    ethereum: ${WEB3_RECIPIENT_ETHEREUM:}
    bsc: ${WEB3_RECIPIENT_BSC:}
  sepolia:
    recipient-address: "0xFBE3a95Caf0d8c9f862Ce16D8eCEf9f1F667aF17"
    chain-id: 11155111
    rpc-url: "https://sepolia.infura.io/v3/"
    supported-tokens:
      - symbol: ETH
        address: "0x0000000000000000000000000000000000000000"
        decimals: 18
        is-native: true
      - symbol: USDT
        address: "0x7169D38820dfd117C3FA1f22a697dba58d90BA06"
        decimals: 6
        is-native: false
      - symbol: USDC
        address: "0x94a9D9AC8a22534E3FaCa9F4e7F2E2cf85d5E4C8"
        decimals: 6
        is-native: false
      - symbol: DAI
        address: "0xFF34B3d4Aee8ddCd6F9AFFFB6Fe49bD371b8a357"
        decimals: 18
        is-native: false
  polygon-amoy:
    recipient-address: "0xFBE3a95Caf0d8c9f862Ce16D8eCEf9f1F667aF17"
    chain-id: 80002
    rpc-url: "https://rpc-amoy.polygon.technology/"
    supported-tokens:
      - symbol: MATIC
        address: "0x0000000000000000000000000000000000000000"
        decimals: 18
        is-native: true
      - symbol: USDT
        address: "0xBD21A10F619BE90d6066c941b04e340BbF10D416"
        decimals: 6
        is-native: false
      - symbol: USDC
        address: "0x0FA8781a83E46826621b3BC0EaA8B9B3875C2eB0"
        decimals: 6
        is-native: false
      - symbol: DAI
        address: "0x001B3B4d0F3714Ca98ba10F6042DaEbF0B1B7b6F"
        decimals: 18
        is-native: false
  common:
    required-confirmations: 1
    payment-timeout-minutes: 15

# CoinGecko API Configuration
coingecko:
  api-url: https://api.coingecko.com/api/v3
  price-cache-ttl: 300  # 5分钟

# Replicate API Configuration
replicate:
  api:
    # Replicate API token - REQUIRED
    # Set via environment variable: export REPLICATE_API_TOKEN="r8_xxx..." (recommended)
    # Or in application-dev.yml: token: r8_xxx... (development only, DO NOT commit to git)
    # Get token from: https://replicate.com/account/api-tokens
    token: ${REPLICATE_API_TOKEN:}
    base-url: https://api.replicate.com/v1
    model: google/nano-banana  # Model name
    timeout: 300000  # 5 minutes in milliseconds
    poll-interval: 2000  # 2 seconds polling interval
  # Callback Configuration (Development)
  webhook:
    enabled: ${REPLICATE_WEBHOOK_ENABLED:true}  # Enable callback in development
    url: ${REPLICATE_WEBHOOK_URL:https://050e73cc9724.ngrok-free.app/api/business/callback}  # Callback URL for development (use ngrok or similar for local testing)
    secret: ${REPLICATE_WEBHOOK_SECRET:}  # Optional callback secret for verification

# Image Upload Configuration
image:
  upload:
    # Upload provider: imgbb (default)
    provider: ${IMAGE_UPLOAD_PROVIDER:imgbb}
    # Maximum file size in bytes (default: 10MB)
    max-size: ${IMAGE_UPLOAD_MAX_SIZE:10485760}
    # ImgBB Configuration
    imgbb:
      # ImgBB API key - REQUIRED
      # Set via environment variable: export IMGBB_API_KEY="your_api_key" (recommended)
      # Or in application-dev.yml: api-key: your_api_key (development only)
      # Get API key from: https://api.imgbb.com/
      api-key: ${IMGBB_API_KEY:}
      api-url: https://api.imgbb.com/1/upload

# MyBatis-Plus Configuration
mybatis-plus:
  # mapper xml 文件路径
  mapper-locations: classpath*:/mapper/**/*.xml
  # 实体类包路径
  type-aliases-package: com.novelhub.entity
  # 配置
  configuration:
    # 驼峰命名转换
    map-underscore-to-camel-case: true
    # 日志实现
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # 缓存
    cache-enabled: false
  # 全局配置
  global-config:
    # 数据库配置
    db-config:
      # 主键类型（AUTO:数据库自增）
      id-type: auto
      # 逻辑删除字段名
      logic-delete-field: deleted
      # 逻辑删除值
      logic-delete-value: 1
      # 逻辑未删除值
      logic-not-delete-value: 0
    # 是否开启 banner
    banner: false

# Logging Configuration
logging:
  level:
    root: INFO
    com.novelhub: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    encoding: UTF-8
    name: logs/novelhub.log
    max-size: 10MB
    max-history: 30

# Management endpoints (for monitoring)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

